# 欠落変数バイアスと因果関係の推定 - 練習問題

**対応レクチャー**: lecture_20251020.pdf
**難易度**: ★★★(上級)
**目標時間**: 120分
**重要度**: S級(試験超重要)

---

## Part 1: 欠落変数バイアス (OVB) の理解

### 問題1: 欠落変数の定義と条件

欠落変数バイアス (Omitted Variable Bias: OVB) について、以下の問いに答えなさい。

(1) **欠落変数**として問題を引き起こすための2つの条件を明確に述べなさい。

(2) なぜこの2つの条件が**両方とも**満たされる必要があるのか、具体例を挙げて説明しなさい。

(3) 条件2（Xとの相関）が満たされない場合、Zを省略してもバイアスが発生しない理由を数学的に説明しなさい。

#### 📖 ヒント
- 真のモデル: Y = Xβ + Zγ + U
- 推定モデル: Y = Xβ + V（Zを省略）
- バイアス = (X'X)^(-1)X'Zγ

#### ✅ 解答

**(1) 欠落変数の2つの条件**

問題を引き起こす「欠落変数」Zは、以下の2つの条件を満たすもの:

**条件1**: 被説明変数Yに対して影響を与えているが、現在のモデルの説明変数として含まれていない（省略されている）
- 数式: γ ≠ 0

**条件2**: モデルに既に含まれている説明変数Xと相関がある
- 数式: Cov(X, Z) ≠ 0 または X'Z ≠ 0

**(2) 両方の条件が必要な理由**

**具体例: クラスサイズ(STR)とテストスコアの関係**

真のモデル: テストスコア = β₀ + β₁・STR + γ₁・教師の質 + γ₂・生徒の家庭環境 + U

**条件1のみ満たす場合（条件2が満たされない）**:
- 教師の質、家庭環境がテストスコアに影響を与える（γ ≠ 0）
- しかし、これらがSTRと無相関ならば（X'Z = 0）、バイアスは発生しない
- 例: 教師の質がSTRとは完全にランダムに割り当てられている場合

**条件2のみ満たす場合（条件1が満たされない）**:
- STRと家庭環境が相関していても（Cov(X,Z) ≠ 0）
- 家庭環境がテストスコアに影響しないなら（γ = 0）、バイアスは発生しない
- なぜなら、省略してもYに影響がないため

**両方満たす場合（実際に問題になる）**:
- 裕福な地域はSTRが低く（小クラス）、かつ家庭環境も良い → 条件2
- 家庭環境はテストスコアに正の影響を与える → 条件1
- 結果: β̂₁（STRの係数）は、STRの真の効果だけでなく、家庭環境の効果も含んでしまう（バイアス）

**(3) 条件2が満たされない場合にバイアスが発生しない数学的理由**

**バイアスの式**:
```
Bias = (X'X)^(-1)X'Zγ
```

**もし X'Z = 0（XとZが無相関）ならば**:
```
Bias = (X'X)^(-1) × 0 × γ = 0
```

**解釈**:
- XとZが無相関であれば、たとえZを省略しても、XがZの効果を「拾って」しまうことがない
- XとZが独立に変動するため、それぞれの効果を分離できる
- これはRCT（ランダム化比較試験）の原理と同じ

---

### 問題2: OVBの数学的導出

真のモデルが Y = Xβ + Zγ + U であるとき、Zを省略したモデル Y = Xβ + V を推定する場合を考える。

(1) OLS推定量 β̂ = (X'X)^(-1)X'Y を展開し、バイアスを導出しなさい。

(2) このバイアスがサンプルサイズnを大きくしても消えない理由を説明しなさい（一致性の喪失）。

(3) 推定量 β̂ の確率極限 plim(β̂) を求めなさい。

#### 📖 ヒント
- Y = Xβ + Zγ + U を β̂ の式に代入
- 期待値または確率極限を考える
- (1/n)X'Z は定数行列に収束する

#### ✅ 解答

**(1) バイアスの導出**

**Step 1**: OLS推定量の定義
```
β̂ = (X'X)^(-1)X'Y
```

**Step 2**: 真のモデルを代入
```
β̂ = (X'X)^(-1)X'(Xβ + Zγ + U)
   = (X'X)^(-1)X'Xβ + (X'X)^(-1)X'Zγ + (X'X)^(-1)X'U
   = β + (X'X)^(-1)X'Zγ + (X'X)^(-1)X'U
```

**Step 3**: 期待値（または確率極限）をとる

OLSの仮定（E[U|X] = 0）より、(X'X)^(-1)X'U の期待値は0に収束する。

したがって:
```
plim(β̂) = β + plim((X'X)^(-1)X'Z)γ
```

**バイアス**:
```
Bias = plim((X'X)^(-1)X'Z)γ = plim((1/n)X'X)^(-1) × plim((1/n)X'Z) × γ
```

(1/n)X'X → Q_XX（定数行列）
(1/n)X'Z → Q_XZ（定数行列、XとZの共分散に関連）

```
Bias = Q_XX^(-1) Q_XZ γ
```

**(2) 一致性の喪失**

**理由**:
- バイアスは Q_XX^(-1) Q_XZ γ という定数
- この値は n（サンプルサイズ）に依存しない
- n → ∞ としても、バイアスはゼロに収束せず、定数として残る
- したがって、β̂ は β に確率収束せず、一致性を失う

**直感的説明**:
- どれだけデータを集めても、Zの情報がない限り、XとZの効果を分離できない
- データ量の問題ではなく、モデルの構造的な問題

**(3) 確率極限**

```
plim(β̂) = β + Q_XX^(-1) Q_XZ γ ≠ β
```

β̂ は真の値 β ではなく、バイアスのかかった値 β + Q_XX^(-1) Q_XZ γ に収束する。

---

### 問題3: 条件付き平均の独立性 (CMI)

真のモデルが Y = β₀ + β₁X + αW + δZ + U で、変数Zのデータが取得できず省略せざるを得ない状況を考える。

(1) 条件付き平均の独立性 (CMI) E[V | X, W] = g(W) の仮定を説明しなさい。

(2) この仮定のもとで、なぜXの係数 β₁ を正しく推定できるのか、詳しく説明しなさい。

(3) Wの係数はどうなるか答えなさい。

#### 📖 ヒント
- V = δZ + U（省略された部分）
- CMIは「Wを条件付ければ、VとXは無相関」を意味する
- モデルの書き換えを考える

#### ✅ 解答

**(1) CMIの仮定の説明**

**定義**: E[V | X, W] = g(W)

ここで:
- V = δZ + U（省略された変数Zを含む誤差項）
- g(W) はWだけの関数

**意味**:
- Wを条件付け（コントロール）すれば、誤差項Vの期待値はXには依存しない
- 言い換えると、X の値が変わっても、同じW の値を持つグループ内では、V の期待値は変わらない
- Wを制御変数として含めることで、Zの影響を間接的にコントロールできる

**例**:
- X = 教育年数、Y = 賃金、Z = 能力（観測不可）、W = 親の収入
- 親の収入が同じ人たちの中では、能力と教育年数は無相関と仮定
- この場合、親の収入をコントロールすれば、教育の因果効果を推定できる

**(2) なぜ β₁ を正しく推定できるか**

**Step 1**: モデルの書き換え

CMI: E[V | X, W] = γ₀ + γ₁W の形で書けるとする

真のモデル:
```
Y = β₀ + β₁X + αW + V
```

両辺の条件付き期待値:
```
E[Y | X, W] = β₀ + β₁X + αW + E[V | X, W]
            = β₀ + β₁X + αW + (γ₀ + γ₁W)
            = (β₀ + γ₀) + β₁X + (α + γ₁)W
```

**Step 2**: 新しい誤差項の定義

元のモデル:
```
Y = β₀ + β₁X + αW + V
```

CMIより:
```
Y = (β₀ + γ₀) + β₁X + (α + γ₁)W + ε
```

ここで ε = V - E[V | X, W] = V - (γ₀ + γ₁W)

**Step 3**: 新しい誤差項の性質

定義により:
```
E[ε | X, W] = E[V - E[V | X, W] | X, W] = E[V | X, W] - E[V | X, W] = 0
```

**結論**:
- 新しいモデルで、OLSの仮定1（E[ε | X, W] = 0）が成立する
- したがって、β₁ は一致性を持って推定できる
- Xの係数は正しく推定される

**(3) Wの係数**

推定されるWの係数は **(α + γ₁)** であり、真の値 α ではない。

**バイアス**: γ₁

**解釈**:
- Wの係数には、WがYに直接与える効果（α）と、省略されたZを通じた間接的な効果（γ₁）の両方が含まれる
- 関心がXの係数だけであれば問題ないが、Wの効果を知りたい場合は、この方法では正しく推定できない

---

## Part 2: 回帰モデルの解釈

### 問題4: ダミー変数モデルの解釈

D を性別を表すダミー変数（男性=0, 女性=1）とし、以下のモデルを推定した:

```
賃金ᵢ = 5.0 + 0.8・Dᵢ
      (0.2) (0.3)
```

括弧内は標準誤差。

(1) 切片 β₀ = 5.0 と係数 β₁ = 0.8 をそれぞれ経済的に解釈しなさい。

(2) β₁ = E[Y | D=1] - E[Y | D=0] となることを示しなさい。

(3) 「男女間で賃金格差はない」という仮説を検定しなさい（有意水準5%）。

#### ✅ 解答

**(1) 経済的解釈**

**切片 β₀ = 5.0**:
- 男性（D=0）の平均賃金
- E[賃金 | D=0] = 5.0
- 男性の平均賃金は5.0（単位: 万円、百万円など）

**係数 β₁ = 0.8**:
- 女性（D=1）と男性（D=0）の平均賃金の差
- 女性の方が男性よりも平均0.8単位高い
- ただし、この結果は統計的に有意かは別途検定が必要

**(2) β₁ = E[Y | D=1] - E[Y | D=0] の証明**

**男性の期待値**（D=0）:
```
E[Y | D=0] = β₀ + β₁ × 0 = β₀ = 5.0
```

**女性の期待値**（D=1）:
```
E[Y | D=1] = β₀ + β₁ × 1 = β₀ + β₁ = 5.0 + 0.8 = 5.8
```

**差**:
```
E[Y | D=1] - E[Y | D=0] = (β₀ + β₁) - β₀ = β₁ = 0.8
```

したがって、β₁は2つのグループ間の平均値の差を表す。

**(3) 仮説検定**

**帰無仮説**: H₀: β₁ = 0（男女間で賃金格差はない）

**t統計量**:
```
t = β̂₁ / SE(β̂₁) = 0.8 / 0.3 = 2.67
```

**判定**（5%水準、両側検定）:
- 臨界値: 1.96
- |t| = 2.67 > 1.96
- **結論**: 帰無仮説を棄却する

**解釈**:
- 男女間の賃金格差は統計的に有意である
- 女性の方が男性よりも平均0.8単位高い賃金を得ており、この差は偶然では説明できない
- ただし、この分析は因果関係を示すものではない（他の要因が制御されていない）

---

### 問題5: 相互作用項（交差項）モデル

ある研究者が、職業訓練プログラム（D: 受講=1, 未受講=0）の効果が、教育年数（Educ）によって異なるかを調べるため、以下のモデルを推定した:

```
賃金 = 3.0 + 0.5・D + 0.3・Educ + 0.2・(D × Educ)
     (0.5) (0.2)   (0.1)      (0.05)
```

(1) 職業訓練の効果（賃金への影響）を教育年数の関数として表しなさい。

(2) 教育年数が12年の人と16年の人では、職業訓練の効果はどれだけ異なるか計算しなさい。

(3) 相互作用項の係数 β₃ = 0.2 を経済的に解釈しなさい。

#### 📖 ヒント
- 訓練の効果 = ∂Y/∂D
- 偏微分を計算する

#### ✅ 解答

**(1) 職業訓練の効果（教育年数の関数として）**

**偏微分**:
```
∂賃金/∂D = β₁ + β₃・Educ = 0.5 + 0.2・Educ
```

**解釈**:
- 職業訓練の効果は、教育年数が1年増えるごとに0.2ずつ増加する
- 教育年数が高い人ほど、職業訓練の効果が大きい

**(2) 教育年数別の訓練効果**

**教育年数12年の場合**:
```
効果 = 0.5 + 0.2 × 12 = 0.5 + 2.4 = 2.9
```

**教育年数16年の場合**:
```
効果 = 0.5 + 0.2 × 16 = 0.5 + 3.2 = 3.7
```

**差**:
```
3.7 - 2.9 = 0.8
```

**解釈**:
- 教育年数12年の人にとって、職業訓練は賃金を2.9単位増加させる
- 教育年数16年の人にとって、職業訓練は賃金を3.7単位増加させる
- 大卒者（16年）の方が高卒者（12年）よりも、職業訓練の効果が0.8単位大きい

**(3) 相互作用項の係数 β₃ = 0.2 の解釈**

**2つの解釈**:

**解釈1**: 教育年数が1年増えると、職業訓練の効果が0.2単位増加する

**解釈2**: 職業訓練を受けると、教育の収益率（教育年数1年あたりの賃金増加）が0.2単位増加する
- 訓練未受講者の教育の収益率: 0.3
- 訓練受講者の教育の収益率: 0.3 + 0.2 = 0.5

**経済的含意**:
- 職業訓練と教育は**補完的な関係**にある
- 教育水準が高い人ほど、職業訓練から多くの利益を得る
- 教育投資と訓練投資の相乗効果がある

---

## Part 3: 因果関係の推定

### 問題6: RCTと観察データの比較

肥料（X）と収穫量（Y）の関係を調べる研究を考える。誤差項U には「土地の豊かさ」「日当たり」などが含まれる。

(1) **RCT（ランダム化比較試験）**を実施した場合、なぜE[U|X] = 0が成立するのか説明しなさい。

(2) **観察データ**を用いた場合、なぜE[U|X] ≠ 0になる可能性があるのか、具体例を挙げて説明しなさい。

(3) RCTの実施が困難な社会科学の例を2つ挙げなさい。

#### ✅ 解答

**(1) RCTでE[U|X] = 0が成立する理由**

**RCTの手順**:
- 研究者が、各農地（区画）に与える肥料の量（X）を**ランダムに**割り当てる
- 例: サイコロを振って、1-2なら肥料少、3-4なら肥料中、5-6なら肥料多

**ランダム化の効果**:
- 肥料の量Xは、土地の特性（U）とは**完全に無関係**に決まる
- 土地が豊かだろうが痩せていようが、肥料の量が決まる確率は同じ
- 数学的には: X ⊥ U（XとUは独立）

**結果**:
```
E[U | X] = E[U] = 0
```
- Xの値に関わらず、Uの期待値は常に0
- したがって、OLSの最も重要な仮定が成立する
- β̂ は X が Y に与える**因果効果**を正しく推定する

**(2) 観察データでE[U|X] ≠ 0になる理由**

**観察データの状況**:
- 農家が、自分の判断で肥料の量（X）を決定する
- 研究者はそのデータを観察するだけ

**内生性の問題**:
- 農家は「日当たりが悪い・土地が痩せている（Uが悪い）場所」に、より多くの肥料（X）を与える可能性がある
- 逆に、土地が豊かな場所には少ない肥料で済ます可能性もある

**具体例1: 負の相関**:
- 土地が痩せている（U < 0）→ 農家はより多くの肥料を使う（X大）
- E[U | X大] < 0
- この場合、OLS推定量は肥料の効果を**過小評価**する

**具体例2: 正の相関**:
- 裕福な農家（良い土地を持つ）は、より多くの肥料を買える
- 土地が豊か（U > 0）かつ 肥料が多い（X大）
- E[U | X大] > 0
- この場合、OLS推定量は肥料の効果を**過大評価**する

**結論**: X と U が相関してしまい（E[U|X] ≠ 0）、OLSの結果はバイアスを持ち、因果関係とは言えない

**(3) RCTが困難な社会科学の例**

**例1: 日銀の為替介入**
- ランダムに介入したり・しなかったりするのは、コストが大きすぎる
- 為替市場への影響が甚大で、実験的な介入は許されない
- 介入のタイミングは経済状況によって決まるため、観察データには強い内生性がある

**例2: ECMO（人工心肺装置）の効果**
- 重症患者にECMOを使うか・使わないかをランダムに決めるのは倫理的に問題
- 患者の生命に関わるため、医師の判断で使用するのが当然
- したがって、ECMO使用（X）と患者の重症度（U）は強く相関する
- E[U | ECMO使用] ≠ E[U | ECMO不使用]

**例3: 教育の効果**
- 子どもをランダムに「大学に行かせる・行かせない」に割り当てるのは不可能
- 大学進学は本人・家族の選択であり、能力や家庭環境と相関する

---

### 問題7: ルービンの因果モデル（潜在的結果）

個人 i が職業訓練を受けるかどうか（Dᵢ: 受けた=1, 受けてない=0）を考える。

(1) 潜在的結果 Yᵢ(1) と Yᵢ(0) の意味を説明しなさい。

(2) 個人の因果効果 τᵢ = Yᵢ(1) - Yᵢ(0) を直接観測できない理由（根本的な問題）を説明しなさい。

(3) ATE（平均処置効果）と ATT（処置群の平均処置効果）の違いを説明しなさい。

#### 📖 ヒント
- 各個人について、2つの潜在的な結果が存在する
- しかし、片方しか観測できない（反実仮想）

#### ✅ 解答

**(1) 潜在的結果の意味**

**Yᵢ(1)**（ワイ・アイ・ワン）:
- 個人 i が**もし訓練を受けた場合**の結果（例: 賃金）
- 処置を受けた状態での潜在的な結果

**Yᵢ(0)**（ワイ・アイ・ゼロ）:
- 個人 i が**もし訓練を受けなかった場合**の結果（例: 賃金）
- 処置を受けなかった状態での潜在的な結果

**重要な点**:
- これら2つの値は、同じ個人 i について定義される
- 両方とも、その個人に「潜在的に」起こりうる結果
- 訓練の有無以外は全て同じ状態を想定している

**(2) 根本的な問題（Fundamental Problem of Causal Inference）**

**問題**:
- 各個人 i について、Yᵢ(1) と Yᵢ(0) の**片方しか観測できない**
- もし訓練を受けたら（Dᵢ=1）: Yᵢ(1) が観測され、Yᵢ(0) は観測されない
- もし訓練を受けなかったら（Dᵢ=0）: Yᵢ(0) が観測され、Yᵢ(1) は観測されない

**観測される値**:
```
観測値 Yᵢ = Dᵢ・Yᵢ(1) + (1-Dᵢ)・Yᵢ(0)
```

**反実仮想（Counterfactual）**:
- 観測されない方の結果を「反実仮想」と呼ぶ
- 例: 実際に訓練を受けた人（Dᵢ=1）にとって、Yᵢ(0)（受けなかった場合の賃金）は反実仮想

**なぜ直接観測できないか**:
- 同じ個人が、同じ時点で、2つの状態（訓練を受けた・受けてない）に同時に存在することはできない
- タイムマシンがない限り、観測は不可能
- これが因果推論の**根本的な困難**

**(3) ATEとATTの違い**

**ATE (Average Treatment Effect; 平均処置効果)**:
```
ATE = E[τᵢ] = E[Yᵢ(1) - Yᵢ(0)]
```

**意味**:
- **集団全体**（訓練を受けた人 + 受けなかった人）に対する処置の平均的な効果
- 「もし全員が訓練を受けたら」と「もし全員が訓練を受けなかったら」の平均的な差

**対象**: 母集団全体

---

**ATT (Average Treatment effect on the Treated; 処置群の平均処置効果)**:
```
ATT = E[τᵢ | Dᵢ=1] = E[Yᵢ(1) - Yᵢ(0) | Dᵢ=1]
```

**意味**:
- **実際に訓練を受けた人たち**にとっての平均的な効果
- 「訓練を受けた人たちが、もし受けなかったら」との比較

**対象**: 処置群（Dᵢ=1）のみ

---

**ATEとATTの違い**:

| 項目 | ATE | ATT |
|------|-----|-----|
| 対象集団 | 全員 | 処置を受けた人のみ |
| 政策的意味 | 「全員に介入すべきか」 | 「現在の参加者にとって有益か」 |
| 関係 | 一般的には ATE ≠ ATT | 処置がランダムなら ATE = ATT |

**例**:
- 訓練を受ける人は、平均的にやる気がある・能力が高い可能性
- このような人たちは、訓練からより多くの利益を得るかもしれない
- したがって、ATT > ATE となる可能性がある

---

### 問題8: RCTにおける因果効果の推定

ランダム化比較試験（RCT）が実施された場合を考える。

(1) RCTにより、処置の割り当て D と潜在的結果 (Y(0), Y(1)) がどのような関係になるか説明しなさい。

(2) この独立性のおかげで、ATE = E[Y | D=1] - E[Y | D=0] と単純化できることを示しなさい。

(3) 単純なOLS回帰 Yᵢ = β₀ + τDᵢ + Uᵢ でも ATE が推定できる理由を説明しなさい。

#### ✅ 解答

**(1) RCTによる独立性**

**ランダム化の効果**:
```
D ⊥ (Y(0), Y(1))
```

**意味**:
- 処置の割り当て D（訓練を受けるか・受けないか）は、潜在的結果 Y(0), Y(1) と**独立**
- D は、個人の特性（能力、やる気、など）とは無関係にランダムに決まる
- 訓練を受けるグループと受けないグループは、**平均的には同じ特性**を持つ

**具体例**:
- 訓練を受けた人（D=1）は、たまたまランダムに選ばれただけで、能力が高いわけではない
- 訓練を受けなかった人（D=0）も、たまたま選ばれなかっただけ
- 両グループの Y(1) と Y(0) の分布は同じ

**(2) ATEの単純化**

**Step 1**: ATEの定義
```
ATE = E[Y(1)] - E[Y(0)]
```

**Step 2**: 独立性 D ⊥ (Y(0), Y(1)) の利用

独立性により:
```
E[Y(1) | D=1] = E[Y(1) | D=0] = E[Y(1)]
E[Y(0) | D=1] = E[Y(0) | D=0] = E[Y(0)]
```

したがって:
```
E[Y(1)] = E[Y(1) | D=1]
E[Y(0)] = E[Y(0) | D=0]
```

**Step 3**: 観測可能な量への変換

観測される Y は:
```
Y = D・Y(1) + (1-D)・Y(0)
```

D=1 のとき:
```
E[Y | D=1] = E[Y(1) | D=1]
```

D=0 のとき:
```
E[Y | D=0] = E[Y(0) | D=0]
```

**Step 4**: ATEの単純化
```
ATE = E[Y(1)] - E[Y(0)]
    = E[Y(1) | D=1] - E[Y(0) | D=0]
    = E[Y | D=1] - E[Y | D=0]
```

**結論**: RCTの下では、ATEは「処置グループのYの平均値」から「非処置グループのYの平均値」を単純に引き算するだけで求められる。

**(3) OLS回帰でATEが推定できる理由**

**モデル**:
```
Yᵢ = β₀ + τDᵢ + Uᵢ
```

**Step 1**: 条件付き期待値

D=0 のとき:
```
E[Y | D=0] = β₀
```

D=1 のとき:
```
E[Y | D=1] = β₀ + τ
```

**Step 2**: τ の解釈
```
τ = E[Y | D=1] - E[Y | D=0]
```

これは前問で示した ATE に等しい。

**Step 3**: OLSの仮定

RCTにより D ⊥ (Y(0), Y(1)) が成立するため:
```
E[U | D] = 0
```

したがって、OLSの最も重要な仮定が満たされる。

**結論**:
- RCTの下では、単純なダミー変数回帰のOLS推定量 τ̂ が ATE の一致推定量となる
- 複雑な手法は不要で、グループ間の平均値の差を計算するだけで因果効果が分かる
- これがRCTが「因果推論のゴールドスタンダード」と呼ばれる理由

---

## Part 4: 観察データでの因果推論

### 問題9: 条件付き独立の仮定 (CIA)

観察データを用いて因果効果を推定する場合、条件付き独立の仮定（CIA）とオーバーラップが重要である。

(1) CIA: (Y(0), Y(1)) ⊥ D | X の仮定を説明しなさい。

(2) オーバーラップ: 0 < P(D=1 | X=x) < 1 の仮定を説明しなさい。

(3) これら2つの仮定のもとで、条件付きATE τ(X) = E[Y(1) | X] - E[Y(0) | X] が観測可能なデータから推定できることを示しなさい。

#### ✅ 解答

**(1) CIA（Conditional Independence Assumption / Unconfoundedness）**

**仮定**:
```
(Y(0), Y(1)) ⊥ D | X
```

**意味**:
- 交絡変数 X を条件付ければ（= X の値が同じ人たちの中では）、処置 D はランダムに割り当てられたかのように独立である
- X の値が同じ人たちの間では、訓練を受ける・受けないは、潜在的結果と無関係

**例**: 職業訓練の効果を推定する場合
- X = {年齢, 学歴, 訓練前の収入, やる気} などの観測可能な交絡変数
- CIA の主張: 「年齢30歳、大卒、訓練前収入300万、やる気スコア80」という全く同じXを持つ人たちの中では、訓練を受けた人と受けなかった人は（観測されない要因も含めて）平均的に同じ

**直感**:
- 観測可能な重要な交絡変数を全て X に含めれば、残りの選択バイアスはない
- これは「重要な変数を全て測定できている」という強い仮定

**(2) オーバーラップ（Common Support）**

**仮定**:
```
0 < P(D=1 | X=x) < 1   for all x
```

**意味**:
- X のどの値においても、処置を受けた人と受けていない人の**両方が存在する**
- 傾向スコア P(D=1|X) が 0 でも 1 でもない

**なぜ必要か**:

**オーバーラップが破れる例**:
- X = 年齢90歳の人は、全員が訓練を受けていない（D=0）
- P(D=1 | 年齢=90) = 0
- この場合、年齢90歳の人について、Y(1)（訓練を受けた場合）を推定する比較対象がいない

**結果**:
- オーバーラップがないと、因果効果を推定できない領域が存在する
- 推定は、オーバーラップが成立する X の範囲に限定される

**(3) 条件付きATEが推定可能であることの証明**

**目標**: τ(X) = E[Y(1) | X] - E[Y(0) | X] を観測データから推定する

**Step 1**: CIAの利用

CIA: (Y(0), Y(1)) ⊥ D | X により:
```
E[Y(1) | D=1, X] = E[Y(1) | D=0, X] = E[Y(1) | X]
E[Y(0) | D=1, X] = E[Y(0) | D=0, X] = E[Y(0) | X]
```

**Step 2**: 観測可能な量への変換

D=1 のグループでは:
```
E[Y | D=1, X] = E[Y(1) | D=1, X]
```

CIAより:
```
E[Y | D=1, X] = E[Y(1) | X]
```

D=0 のグループでは:
```
E[Y | D=0, X] = E[Y(0) | D=0, X]
```

CIAより:
```
E[Y | D=0, X] = E[Y(0) | X]
```

**Step 3**: 条件付きATEの推定
```
τ(X) = E[Y(1) | X] - E[Y(0) | X]
     = E[Y | D=1, X] - E[Y | D=0, X]
```

**結論**:
- E[Y | D=1, X] は、処置を受けた人（D=1）の中で、X=x を持つ人たちのYの平均値（観測可能）
- E[Y | D=0, X] は、処置を受けなかった人（D=0）の中で、X=x を持つ人たちのYの平均値（観測可能）
- この差が、条件付きATE τ(X) になる

**全体のATEの推定**:
```
ATE = E_X[τ(X)] = E_X[E[Y | D=1, X] - E[Y | D=0, X]]
```

Xについて平均（期待値）をとれば、全体のATEが得られる。

---

### 問題10: 回帰による因果効果の推定

CIAとオーバーラップの仮定のもとで、以下の手順で因果効果を推定することを考える。

(1) m₁(X) = E[Y | D=1, X] と m₀(X) = E[Y | D=0, X] をそれぞれ推定する方法を説明しなさい。

(2) 条件付きATE τ(X) = m₁(X) - m₀(X) を計算する。

(3) 全体のATE を推定する方法を説明しなさい。

(4) この方法の利点と限界を述べなさい。

#### ✅ 解答

**(1) m₁(X) と m₀(X) の推定方法**

**m₁(X) = E[Y | D=1, X] の推定**:

**手順**:
- D=1（処置を受けた人）のサンプル**だけ**を使う
- Y を X に回帰する（OLS、または非線形回帰）
- 得られた回帰式が m̂₁(X)

**具体例**:
```
訓練受講者のサンプルで: 賃金ᵢ = α₀ + α₁・年齢ᵢ + α₂・学歴ᵢ + εᵢ
```

推定された式:
```
m̂₁(X) = α̂₀ + α̂₁・年齢 + α̂₂・学歴
```

---

**m₀(X) = E[Y | D=0, X] の推定**:

**手順**:
- D=0（処置を受けなかった人）のサンプル**だけ**を使う
- Y を X に回帰する
- 得られた回帰式が m̂₀(X)

**具体例**:
```
訓練未受講者のサンプルで: 賃金ᵢ = γ₀ + γ₁・年齢ᵢ + γ₂・学歴ᵢ + ηᵢ
```

推定された式:
```
m̂₀(X) = γ̂₀ + γ̂₁・年齢 + γ̂₂・学歴
```

**(2) 条件付きATEの計算**

**各個人について**:
```
τ̂(Xᵢ) = m̂₁(Xᵢ) - m̂₀(Xᵢ)
```

**例**:
- 個人 i: 年齢=30, 学歴=16年
- m̂₁(Xᵢ) = 500万円（訓練を受けた場合の予測賃金）
- m̂₀(Xᵢ) = 450万円（訓練を受けなかった場合の予測賃金）
- τ̂(Xᵢ) = 500 - 450 = 50万円（この人にとっての訓練の効果）

**解釈**:
- 年齢30歳、学歴16年の人にとって、訓練の効果は50万円
- 異なるXを持つ人には、異なる効果がある（異質な処置効果）

**(3) 全体のATEの推定**

**方法**: 条件付きATE τ̂(Xᵢ) を全サンプルで平均する

```
ÂTE = (1/n) Σᵢ τ̂(Xᵢ) = (1/n) Σᵢ [m̂₁(Xᵢ) - m̂₀(Xᵢ)]
```

**手順**:
1. 全サンプル（D=1 と D=0 の両方）の各個人 i について
2. その人のXᵢを使って、m̂₁(Xᵢ) と m̂₀(Xᵢ) を計算
3. τ̂(Xᵢ) = m̂₁(Xᵢ) - m̂₀(Xᵢ) を計算
4. これをn人分全て平均する

**結果**: これが全体の平均処置効果 ATE の推定量となる

**(4) 利点と限界**

**利点**:

1. **異質な処置効果を捉えられる**:
   - 全員に同じ効果を仮定しない
   - 個人・グループごとに効果が異なることを許容
   - 政策のターゲティングに有用

2. **柔軟性**:
   - 線形回帰だけでなく、機械学習などの非線形モデルも使える
   - Xが多次元でも対応可能

3. **直感的**:
   - 「受けた場合」と「受けなかった場合」を別々に予測して比較
   - 解釈しやすい

**限界**:

1. **CIAへの依存**:
   - CIAが成立しない（観測されない交絡変数がある）場合、推定はバイアスを持つ
   - この仮定は検証不可能（信じるしかない）

2. **モデルの誤定式化のリスク**:
   - m₁(X) や m₀(X) を正しく推定できないと、因果効果の推定も誤る
   - 特に、X が高次元の場合は難しい

3. **オーバーラップの問題**:
   - X の一部の領域で D=1 または D=0 が少ないと、予測が不安定
   - 外挿（extrapolation）のリスク

4. **観測データの限界**:
   - RCTと比べて、因果関係の証拠としては弱い
   - 結果の解釈には慎重さが必要

---

## 🎯 学習到達度チェックリスト

### レベル1: 基礎概念の理解
- [ ] 欠落変数の2つの条件を説明できる
- [ ] OVBのバイアスが一致性を失わせることを理解している
- [ ] CMI（条件付き平均の独立性）の意味を説明できる
- [ ] ダミー変数モデルの係数を解釈できる
- [ ] 相互作用項の意味を理解している
- [ ] RCTと観察データの違いを説明できる
- [ ] 潜在的結果 Y(0), Y(1) の意味を理解している
- [ ] ATE と ATT の違いを説明できる

### レベル2: 数学的理解と計算
- [ ] OVBのバイアスを数学的に導出できる
- [ ] CMIのもとで係数が正しく推定できる理由を説明できる
- [ ] 相互作用項を含むモデルで偏効果を計算できる
- [ ] RCTのもとでATE = E[Y|D=1] - E[Y|D=0] を証明できる
- [ ] CIAとオーバーラップの仮定を理解している
- [ ] 条件付きATEが観測データから推定できることを示せる
- [ ] 回帰による因果効果推定の手順を説明できる

### レベル3: 批判的思考と応用
- [ ] 実際の研究でOVBが発生する例を具体的に挙げられる
- [ ] RCTが実施困難な状況とその理由を説明できる
- [ ] 因果推論の根本的問題を理解している
- [ ] CIAが成立しない状況を具体的に議論できる
- [ ] 観察データでの因果推論の利点と限界を評価できる
- [ ] 次回講義（傾向スコアマッチング）への準備ができている

---

## 💡 重要ポイントまとめ

### 🔥 試験で最も重要な5点

1. **欠落変数バイアスの2条件**
   - Yに影響 & Xと相関
   - 両方満たすと一致性が失われる
   - サンプルサイズを増やしても解決しない

2. **E[U|X] = 0 の重要性**
   - 因果推論の核心
   - RCTで成立、観察データでは困難
   - 満たされないと β̂ は因果効果でない

3. **相互作用項の解釈**
   - 効果がもう一つの変数の値によって変わる
   - 偏微分で限界効果を計算
   - DID（差分の差分法）でも利用

4. **潜在的結果と根本的問題**
   - Y(0) と Y(1) は両方存在するが片方しか観測できない
   - 因果効果 = Y(1) - Y(0)
   - RCTはこの問題を「平均で」解決する

5. **CIA（条件付き独立）の役割**
   - 観察データで因果推論するための鍵
   - 重要な交絡変数を全て制御すれば因果効果が推定可能
   - 検証不可能な強い仮定

### 📌 よくある誤解

| 誤解 | 正しい理解 |
|------|-----------|
| Xと相関する変数を省略すると必ずバイアス | Yに影響しなければバイアスなし（2条件必要） |
| サンプルを増やせばOVBは消える | 一致性が失われるため、n→∞でも消えない |
| 相互作用項は常に必要 | 効果が一定なら不要（検定で判断） |
| ATE = ATT である | 一般には異なる（RCTでは等しい） |
| CIAは検証可能 | 検証不可能（信じるしかない） |
| 観察データでは因果推論は不可能 | CIAが成立すれば可能（ただし強い仮定） |

---

## 📚 次回予告

次回の講義では、観察データでの因果推論の具体的手法を学びます:

1. **傾向スコア（Propensity Score）**
   - 高次元の X を1次元に要約
   - P(D=1|X) の推定

2. **傾向スコアマッチング**
   - 似た傾向スコアを持つ個人同士を比較
   - 処置群と対照群の均衡化

3. **逆確率重み付け（IPW）**
   - サンプルに重みをつけて疑似的なRCTを作る

4. **二重に頑健な推定量**
   - 回帰とIPWを組み合わせる

**今回の内容（特にCIAとオーバーラップ）が基礎となるので、しっかり復習しておきましょう！**

---

**この練習問題を完璧にマスターすれば、因果推論の基礎理論は万全です！**
